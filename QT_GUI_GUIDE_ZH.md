# Qt 圖形介面應用程式指南

## 概述

足球分析 Qt 圖形介面應用程式（`qt_main.py`）提供了一個直觀的圖形界面，用於分析足球比賽影片。本指南將幫助您開始使用此應用程式。

## 前提條件

在執行 Qt 圖形介面應用程式之前，請確保您具備：

1. **Python 3.7 或更高版本**
2. **所有必需的依賴項**已安裝（請參閱安裝部分）
3. **YOLO 模型檔案**（`models/best.pt`）已下載並放置在 models 目錄中
4. **輸入影片檔案**準備好進行分析

## 安裝

### 步驟 1：安裝依賴項

```bash
# 使用 requirements.txt 安裝所有必需的套件
pip install -r requirements.txt

# 或分別安裝套件：
pip install PyQt5 ultralytics supervision opencv-python numpy matplotlib pandas scikit-learn
```

### 步驟 2：下載模型

從以下位置下載訓練好的 YOLO v5 模型：
- [訓練的 Yolo v5](https://drive.google.com/file/d/1DC2kCygbBWUKheQ_9cFziCsYVSRw6axK/view?usp=sharing)

將下載的模型檔案放在 `models/` 目錄中，命名為 `best.pt`。

### 步驟 3：準備輸入影片

將您的足球比賽影片放在 `input_videos/` 目錄中，或將其準備好放在任何可訪問的位置。

## 在 Qt Creator 中開啟專案（選擇性）

如果您更喜歡使用 Qt Creator IDE 進行開發：

1. 開啟 Qt Creator
2. 選擇「檔案」→「開啟檔案或專案...」
3. 導航到專案目錄
4. 選擇 `foot.pro` 檔案
5. 點擊「開啟」

Qt Creator 將載入專案，所有 Python 檔案都已組織好並可訪問。然後您可以：
- 瀏覽和編輯 Python 原始檔案
- 使用 Qt Creator 的搜尋和導航功能
- 在檔案樹中查看專案結構
- 仍然使用終端中的 Python 或 Qt Creator 的終端執行應用程式

**注意**：Qt Creator 主要是一個 C++/Qt IDE，但它可以將 Python 專案作為通用專案開啟。要執行 Python 應用程式，請繼續使用下面的命令。

## 啟動應用程式

```bash
python qt_main.py
```

應用程式視窗將開啟，有兩個主要部分：
- **左側面板**：控制項、設定和日誌
- **右側面板**：用於預覽和播放的影片播放器

## 使用應用程式

### 1. 選擇輸入影片

1. 點擊「**瀏覽...**」按鈕（在「未選擇影片」旁邊）
2. 導航到您的影片檔案（支援 .mp4、.avi、.mov）
3. 選擇檔案並點擊「開啟」
4. 影片預覽將載入到右側的播放器中

### 2. 配置設定（選擇性）

**使用快取資料：**
- 勾選此選項以使用先前計算的追蹤和相機移動資料
- 顯著加快相同影片的重新分析速度
- 未勾選：從頭開始完整分析（較慢但總是最新的）

**模型選擇：**
- 預設：`models/best.pt`
- 自訂：選擇「自訂...」以瀏覽不同的 YOLO 模型

**輸出路徑：**
- 點擊「**變更...**」以指定自訂輸出位置
- 預設：`output_videos/output_video.avi`

### 3. 開始分析

1. 點擊「**開始分析**」按鈕（綠色按鈕）
2. 分析過程將在後台開始
3. 透過以下方式監控進度：
   - **進度條**：顯示完成百分比（0-100%）
   - **狀態標籤**：顯示當前處理步驟
   - **分析日誌**：所有操作的詳細日誌

### 4. 分析期間

- 應用程式在處理期間保持回應
- 您可以閱讀日誌以查看詳細進度
- 點擊「**停止**」隨時取消分析
- 處理階段包括：
  1. 讀取影片（5%）
  2. 初始化追蹤器（10%）
  3. 偵測和追蹤物體（15%）
  4. 計算位置（25%）
  5. 估計相機移動（30%）
  6. 應用透視轉換（40%）
  7. 插值足球位置（45%）
  8. 計算速度和距離（50%）
  9. 分配球隊（55%）
  10. 分析控球（60%）
  11. 生成標註影格（70%）
  12. 儲存輸出影片（90%）
  13. 完成（100%）

### 5. 查看結果

分析完成後：
1. 輸出影片自動載入到播放器中
2. 使用**播放控制**：
   - **播放/暫停**：開始或暫停影片播放
   - **滑桿**：拖動以跳到任何影格
   - **影格計數器**：顯示當前影格編號

### 6. 查看輸出

分析的影片包括：
- **球員追蹤**：球員周圍的彩色橢圓（球隊顏色）
- **球員 ID**：每個球員顯示的編號
- **足球追蹤**：標記足球的綠色三角形
- **控球**：控球球員上方的紅色三角形
- **球隊統計**：控球百分比
- **相機移動**：X/Y 移動顯示
- **球員指標**：每個球員的速度（公里/小時）和距離（米）

## 提示和技巧

### 效能優化

1. **使用快取**：啟用「使用快取資料」以加快重新執行速度
   - 首次執行：完整分析（較慢）
   - 後續執行：使用快取的追蹤資料（快得多）

2. **影片解析度**：較低解析度的影片處理更快
   - 考慮在分析前縮小大型影片

3. **幀率**：較高幀率的影片需要更長的處理時間
   - 標準 24-30 fps 效果良好

### 疑難排解

**問題：應用程式無法啟動**
- 解決方案：確保已安裝 PyQt5：`pip install PyQt5`

**問題：「找不到模型檔案」錯誤**
- 解決方案：下載並將 `best.pt` 放在 `models/` 目錄中

**問題：分析因匯入錯誤而失敗**
- 解決方案：安裝所有依賴項：`pip install -r requirements.txt`

**問題：影片無法在播放器中載入**
- 解決方案：確保影片格式受支援（MP4、AVI、MOV）
- 嘗試轉換為標準格式

**問題：分析期間記憶體不足**
- 解決方案：
  - 處理較短的影片片段
  - 關閉其他應用程式
  - 使用更多 RAM 的機器

**問題：效能緩慢**
- 解決方案：
  - 啟用快取以進行重新分析
  - 使用 GPU 加速的 YOLO（如果可用）
  - 處理較小的影片或次取樣影格

### 進階使用

#### 自訂模型

要使用自訂訓練的 YOLO 模型：
1. 從模型下拉式選單中選擇「自訂...」
2. 瀏覽到您的模型檔案（.pt 格式）
3. 自訂模型將用於偵測

#### 批次處理

要分析多個影片：
1. 分析第一個影片
2. 等待完成
3. 選擇下一個影片並重複
4. 每個影片生成一個單獨的輸出檔案

#### 匯出設定

應用程式預設以 AVI 格式和 XVID 編解碼器儲存影片。要變更格式，請修改 `utils/video_utils.py` 中的 `save_video()` 函數。

## 鍵盤快捷鍵

當影片播放器被聚焦時：
- **空格鍵**：播放/暫停（實作時）
- **左/右箭頭**：上一幀/下一幀（透過滑桿）

## 架構

Qt 圖形介面應用程式建立在現有的分析模組之上：

```
Qt GUI (qt_main.py)
    ↓
主視窗（UI 佈局）
    ├── 控制面板
    │   ├── 檔案選擇
    │   ├── 設定
    │   └── 分析控制
    ├── 影片播放器
    │   ├── 顯示小工具
    │   └── 播放控制
    └── 分析執行緒（背景）
        └── 分析管道（現有模組）
```

### 關鍵組件

1. **FootballAnalysisGUI**：主視窗類別
2. **VideoPlayer**：影片顯示和播放的小工具
3. **VideoAnalysisThread**：用於處理的背景執行緒
4. **Qt 信號**：執行緒和 UI 之間的通訊

## Qt 圖形介面的好處

### 與命令列相比

**圖形介面優勢：**
- 無需編輯程式碼
- 處理期間的視覺回饋
- 內建影片播放器
- 簡單配置
- 適合初學者
- 可以停止/取消處理
- 即時進度更新

**命令列優勢：**
- 可編寫腳本/自動化
- 較低的資源使用
- 更適合批次處理
- 可以在沒有顯示的伺服器上執行

### 何時使用圖形介面

- 首次使用者
- 互動式分析會話
- 測試不同設定
- 展示系統
- 當您想立即預覽結果時

### 何時使用命令列

- 自動化工作流程
- 批次處理多個影片
- 在遠端伺服器上執行
- 腳本和自動化
- CI/CD 管道

## 未來增強功能

Qt 圖形介面的潛在改進：
- 即時影片處理預覽
- 將統計資料匯出到 CSV
- 多影片比較
- 熱圖視覺化
- 逐幀標註編輯
- 影片修剪工具
- 自訂球隊顏色選擇
- 球員統計儀表板

## 支援

如有問題或疑問：
1. 查看本指南以獲取疑難排解資訊
2. 查閱主 README_ZH.md 以獲取技術細節
3. 確保所有依賴項都正確安裝
4. 驗證影片檔案是否為支援的格式

## 技術說明

- **執行緒安全**：分析在單獨的 QThread 中執行以保持 UI 回應
- **記憶體管理**：大型影片分塊處理
- **快取**：Pickle 檔案儲存中間結果以加快重新執行
- **影片編解碼器**：輸出使用 XVID 編解碼器以實現廣泛相容性

## 範例工作流程

從頭到尾的完整範例：

```bash
# 1. 安裝依賴項
pip install -r requirements.txt

# 2. 下載並放置模型檔案
# （將 best.pt 下載到 models/ 目錄）

# 3. 啟動圖形介面
python qt_main.py

# 4. 在圖形介面中：
#    - 點擊「瀏覽...」並選擇輸入影片
#    - 查看設定（預設值即可）
#    - 點擊「開始分析」
#    - 等待完成（監控進度）
#    - 在播放器中查看結果
#    - 輸出儲存到 output_videos/

# 5. 對於下一個影片：
#    - 選擇新的輸入影片
#    - 如果是相同影片，啟用「使用快取資料」
#    - 再次開始分析
```

就是這樣！您已準備好使用 Qt 圖形介面應用程式分析足球比賽了。

## 常見問題解答

### 問：為什麼要使用圖形介面而不是命令列？

答：圖形介面更容易使用，特別是對於初學者。它提供即時視覺回饋、內建影片播放器，並且不需要編輯任何程式碼。

### 問：我可以同時處理多個影片嗎？

答：不行，一次只能處理一個影片。但您可以在一個完成後快速載入下一個。

### 問：快取資料儲存在哪裡？

答：快取資料儲存在 `stubs/` 目錄中：
- `track_stubs.pkl`：追蹤資料
- `camera_movement_stub.pkl`：相機移動資料

### 問：如何刪除快取？

答：只需刪除 `stubs/` 目錄中的 .pkl 檔案：
```bash
rm stubs/*.pkl
```

### 問：我可以變更輸出影片格式嗎？

答：可以，但需要修改程式碼。編輯 `utils/video_utils.py` 中的 `save_video()` 函數以變更編解碼器和格式。

### 問：圖形介面支援即時影片嗎？

答：目前不支援。圖形介面僅處理預錄製的影片檔案。

### 問：我可以暫停分析然後繼續嗎？

答：不行，分析一旦開始就無法暫停。您只能停止它，然後重新開始。

### 問：為什麼第一次執行這麼慢？

答：第一次執行需要：
- 載入和初始化 YOLO 模型
- 處理所有影格
- 生成快取資料

後續執行使用快取會快得多。

### 問：我可以在沒有 GPU 的情況下執行嗎？

答：可以，但處理速度會較慢。YOLO 可以在 CPU 上執行，只是需要更多時間。

### 問：如何提高分析速度？

答：
1. 使用 GPU（如果可用）
2. 啟用快取以進行重新分析
3. 降低影片解析度
4. 減少影片長度
5. 降低幀率

---

**祝您使用 Qt 圖形介面愉快！⚽🖥️**
